<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>gopls asdf &#183; TIL</title><link rel=stylesheet href=/til/css/style.css><link rel=stylesheet href=/til/css/fonts.css><link rel=icon type=image/png sizes=32x32 href=/til/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/til/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/til/images/apple-touch-icon.png><link href rel=alternate type=application/rss+xml title=TIL></head><body><nav class=nav><div class=nav-container><a href=/><h2 class=nav-title>TIL</h2></a><ul></ul></div></nav><main><div class=post><div class=post-info><span>Written by</span>
Hector Rios<br><span>on&nbsp;</span><time datetime="2021-10-10 00:00:00 +0000 UTC">October 10, 2021</time></div><h1 class=post-title>gopls asdf</h1><div class=post-line></div><h1 id=tldr>tl;dr</h1><p>Ensure that your <code>GOPATH</code> has your <code>asdf</code> go env!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>export GOROOT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/.asdf/installs/golang/1.17.go&#34;</span>
</span></span><span style=display:flex><span>export GOPATH<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>go env GOPATH<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$PATH<span style=color:#e6db74>:</span><span style=color:#66d9ef>$(</span>go env GOPATH<span style=color:#66d9ef>)</span><span style=color:#e6db74>/bin&#34;</span>
</span></span></code></pre></div><h1 id=preface>Preface</h1><p>I apologise if this is all over the place. I mainly spent the last two hours searching for a solution, and was able to
conjure up a solution (detailed below). I&rsquo;m primarily writing this for myself; please excuse any bouncing between
ideas/concepts.</p><h1 id=background>Background</h1><p>I&rsquo;ve been playing around with <code>nvim</code> for a bit of time now. I haven&rsquo;t taken advantage of the native <code>lsp</code> protocol built
into version 0.5+. I&rsquo;ve been trying to write more go for personal projects, such as
<a href=https://github.com/hectron/fauci.d/><code>fauci.d</code></a>, so my desire for LSP quickly spiked. For Go, the <code>LSP</code> server is
<code>gopls</code>.</p><h1 id=getting-nvim-configured-with-gopls>Getting nvim configured with gopls</h1><p>This step is pretty easy. In your nvim config files, you configure the <code>lsp</code> plugin of your choice to use <code>gopls</code>. I&rsquo;m
using <code>neovim/nvim-lspconfig</code> plugin, so for me it looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span><span style=color:#a6e22e>lua</span> &lt;&lt; <span style=color:#a6e22e>EOF</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>local</span> <span style=color:#a6e22e>nvim_lsp</span> = <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;lspconfig&#39;</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>local</span> <span style=color:#a6e22e>on_attach</span> = <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>client</span>, <span style=color:#a6e22e>bufnr</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  -- <span style=color:#a6e22e>configuring</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>lspconfig</span> <span style=color:#a6e22e>plugin</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>end</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>-- <span style=color:#a6e22e>this</span> <span style=color:#a6e22e>tells</span> <span style=color:#a6e22e>nvim</span> <span style=color:#a6e22e>lsp</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>register</span> <span style=color:#a6e22e>a</span> <span style=color:#a6e22e>new</span> <span style=color:#a6e22e>language</span> <span style=color:#a6e22e>server</span>, <span style=color:#a6e22e>named</span> <span style=color:#a6e22e>gopls</span>, <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>use</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>configuration</span> <span style=color:#a6e22e>from</span> <span style=color:#a6e22e>above</span>.<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>nvim_lsp</span>.<span style=color:#a6e22e>gopls</span>.<span style=color:#a6e22e>setup</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>  <span style=color:#a6e22e>on_attach</span> = <span style=color:#a6e22e>on_attach</span>,<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#a6e22e>EOF</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Once you save and reload your nvim, you should be good to go &ndash; but I wasn&rsquo;t. I ran into the following issue when navigating into
go files:</p><pre tabindex=0><code>cmd [&#34;gopls&#34;] is not executable
</code></pre><p>This means that nvim cannot find an executable named <code>gopls</code>. You can check by running the following command in nvim:
<code>:echo executable('gopls')</code>. If it returns a 1, then it is available and ready to be used. <strong>I kept getting 0</strong>, despite
installing the binary manually.</p><p>TLDR, this turned out to be a problem because I never set my <code>$GOPATH</code> and <code>$GOROOT</code> environment variables. <code>asdf</code>
allows you to install multiple versions of <code>go</code>, so I&rsquo;m still a little unclear how to manage these. However, the
following configuration in my <code>.zshrc</code> did the trick:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>export GOROOT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/.asdf/installs/golang/1.17.go&#34;</span>
</span></span><span style=display:flex><span>export GOPATH<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>go env GOPATH<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$PATH<span style=color:#e6db74>:</span><span style=color:#66d9ef>$(</span>go env GOPATH<span style=color:#66d9ef>)</span><span style=color:#e6db74>/bin&#34;</span>
</span></span></code></pre></div><p>Once this was set, I fired up <code>nvim</code> and loaded up a go file, only to have everything work.</p></div><div class=pagination><a href=/til/moving-fully-to-nvim/ class="left arrow">&#8592;</a>
<a href=/til/multiple-aws-configs/ class="right arrow">&#8594;</a>
<a href=# class=top>Top</a></div></main><footer><span>&copy; <time datetime="2022-08-12 02:38:35.023856084 +0000 UTC m=+0.080247692">2022</time> Hector Rios. Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.</span></footer></body></html>