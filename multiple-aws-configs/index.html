<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Multiple AWS config files &#183; TIL</title><link rel=stylesheet href=/til/css/style.css><link rel=stylesheet href=/til/css/fonts.css><link rel=icon type=image/png sizes=32x32 href=/til/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/til/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/til/images/apple-touch-icon.png><link href rel=alternate type=application/rss+xml title=TIL></head><body><nav class=nav><div class=nav-container><a href=/><h2 class=nav-title>TIL</h2></a><ul></ul></div></nav><main><div class=post><div class=post-info><span>Written by</span>
Hector Rios<br><span>on&nbsp;</span><time datetime="2022-08-11 00:00:00 +0000 UTC">August 11, 2022</time></div><h1 class=post-title>Multiple AWS config files</h1><div class=post-line></div><h1 id=tldr>tl;dr</h1><p>Use direnv and <a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html>environment variables to configure the AWS CLI</a> to ensure you are interacting with the right AWS account.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>mkdir -p $HOME/code/cnd <span style=color:#f92672>&amp;&amp;</span> cd $_
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;export AWS_CONFIG_FILE=&#34;$HOME/.aws/cnd_config&#34;&#39;</span> &gt; .envrc
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;export AWS_SHARED_CREDENTIALS_FILE=&#34;$HOME/.aws/cnd_credentials&#34;&#39;</span> &gt;&gt; .envrc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>direnv allow
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>aws s3 ls <span style=color:#75715e># confirm that this works!</span>
</span></span></code></pre></div><h2 id=problem>Problem</h2><p>It&rsquo;s very common for me to have to do work for multiple clients on the same computer. This can be difficult to manage because different organizations use different credentials. This problem is solved in code by using things like <code>asdf</code>, <code>nvm</code>,
<code>rbenv</code> and <code>pipenv</code>. But how do we manage this for tools like the AWS CLI?</p><h2 id=proposal>Proposal</h2><p>The AWS CLI references a <code>~/.aws/config</code> (and optionally a <code>~/.aws/credentials</code>) file. What if we found a way to point
the AWS CLI to a specific file?</p><p>Fortunately, <a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html>the AWS CLI uses two environment variables</a> to determine where to find these files:</p><ul><li><code>AWS_CONFIG_FILE</code>, which defaults to <code>$HOME/.aws/config</code></li><li><code>AWS_SHARED_CREDENTIALS_FILE</code>, which defaults to <code>$HOME/.aws/credentials</code></li></ul><p>One thing I&rsquo;ve been leveraging in my workflow is using direnv to set environment variables on a file-system hierachical basis.</p><p>In other words:</p><ul><li>when I&rsquo;m in <code>$HOME/code/work</code>, I have custom, base environment variables set in <code>$HOME/code/work/.envrc</code></li><li>when I&rsquo;m in <code>$HOME/code/me</code>, I have custom, base environment variables set specific to my personal work</li><li>and so on</li></ul><p>What if I did something similar to <strong>emulate</strong> starting a session on a per-environment basis?</p><h2 id=solution>Solution</h2><p>First, I created prefixed files in my <code>$HOME/.aws</code> directory with the extension of my volunteer organization (Center for New Data &ndash; or cnd for short). This means both <code>$HOME/.aws/cnd_config</code> and <code>$HOME/.aws/cnd_credentials</code> exist.</p><p>Next, I created <code>$HOME/code/cnd/.envrc</code> where I set both <code>AWS_CONFIG_FILE</code> and <code>AWS_SHARED_CREDENTIALS_FILE</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># example $HOME/code/cnd/.envrc file</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export AWS_CONFIG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/.aws/cnd_config&#34;</span>
</span></span><span style=display:flex><span>export AWS_SHARED_CREDENTIALS_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/.aws/cnd_credentials&#34;</span>
</span></span></code></pre></div><p><strong>Side note:</strong> Could I have set this at the <code>$HOME/code/cnd/.aws/config</code> and <code>$HOME/code/cnd/.aws/credentials</code>? Sure! I decided to leave them in <code>$HOME/.aws</code> because that&rsquo;s the default place to look and frankly I have that directory memorized haha.</p><h1 id=closing-thoughts>Closing thoughts</h1><p>I think this works pretty nice! I&rsquo;m able to swap in and out of my directories and know that I&rsquo;m interacting with the right AWS account.</p><p>One thing I miss about working in Windows is using WSL to have multiple Linux instances completely separate, so that I can be TOTALLY sure. This solution works for those with a single computer ðŸ˜Ž</p></div><div class=pagination><a href=/til/gopls-asdf/ class="left arrow">&#8592;</a>
<a href=# class=top>Top</a></div></main><footer><span>&copy; <time datetime="2022-08-12 02:38:35.027488065 +0000 UTC m=+0.083879573">2022</time> Hector Rios. Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.</span></footer></body></html>